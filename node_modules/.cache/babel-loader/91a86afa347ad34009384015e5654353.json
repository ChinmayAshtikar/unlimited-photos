{"ast":null,"code":"import _toConsumableArray from\"/Users/chinmay/Desktop/Chinmay/react-projects-master/19-stock-photos/final/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _asyncToGenerator from\"/Users/chinmay/Desktop/Chinmay/react-projects-master/19-stock-photos/final/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/chinmay/Desktop/Chinmay/react-projects-master/19-stock-photos/final/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/chinmay/Desktop/Chinmay/react-projects-master/19-stock-photos/final/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect,useRef}from'react';import{FaSearch}from'react-icons/fa';import Photo from'./Photo';var clientID=\"?client_id=\".concat(process.env.REACT_APP_ACCESS_KEY);var mainUrl=\"https://api.unsplash.com/photos/\";var searchUrl=\"https://api.unsplash.com/search/photos/\";// remove current scroll code\n// set default page to 1\n// setup two useEffects\n// don't run second on initial render\n// check for query value\n// if page 1 fetch images\n// otherwise setPage(1)\n// fix scroll functionality\nfunction App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),photos=_useState4[0],setPhotos=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),page=_useState6[0],setPage=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),query=_useState8[0],setQuery=_useState8[1];var mounted=useRef(false);var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),newImages=_useState10[0],setNewImages=_useState10[1];var fetchImages=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var url,urlPage,urlQuery,response,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);urlPage=\"&page=\".concat(page);urlQuery=\"&query=\".concat(query);if(query){url=\"\".concat(searchUrl).concat(clientID).concat(urlPage).concat(urlQuery);}else{url=\"\".concat(mainUrl).concat(clientID).concat(urlPage);}_context.prev=4;_context.next=7;return fetch(url);case 7:response=_context.sent;_context.next=10;return response.json();case 10:data=_context.sent;setPhotos(function(oldPhotos){if(query&&page===1){return data.results;}else if(query){return[].concat(_toConsumableArray(oldPhotos),_toConsumableArray(data.results));}else{return[].concat(_toConsumableArray(oldPhotos),_toConsumableArray(data));}});setNewImages(false);setLoading(false);_context.next=20;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](4);setNewImages(false);setLoading(false);case 20:case\"end\":return _context.stop();}}},_callee,null,[[4,16]]);}));return function fetchImages(){return _ref.apply(this,arguments);};}();useEffect(function(){fetchImages();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[page]);useEffect(function(){if(!mounted.current){mounted.current=true;return;}if(!newImages)return;if(loading)return;setPage(function(oldPage){return oldPage+1;});},[loading,newImages]);var event=function event(){if(window.innerHeight+window.scrollY>=document.body.scrollHeight-2){setNewImages(true);}};useEffect(function(){window.addEventListener('scroll',event);return function(){return window.removeEventListener('scroll',event);};},[]);var handleSubmit=function handleSubmit(e){e.preventDefault();if(!query)return;if(page===1){fetchImages();}setPage(1);};return/*#__PURE__*/React.createElement(\"main\",null,/*#__PURE__*/React.createElement(\"section\",{className:\"search\"},/*#__PURE__*/React.createElement(\"form\",{className:\"search-form\"},/*#__PURE__*/React.createElement(\"input\",{type:\"text\",placeholder:\"search\",value:query,onChange:function onChange(e){return setQuery(e.target.value);},className:\"form-input\"}),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"submit-btn\",onClick:handleSubmit},/*#__PURE__*/React.createElement(FaSearch,null)))),/*#__PURE__*/React.createElement(\"section\",{className:\"photos\"},/*#__PURE__*/React.createElement(\"div\",{className:\"photos-center\"},photos.map(function(image,index){return/*#__PURE__*/React.createElement(Photo,Object.assign({key:index},image));})),loading&&/*#__PURE__*/React.createElement(\"h2\",{className:\"loading\"},\"Loading...\")));}export default App;","map":{"version":3,"sources":["/Users/chinmay/Desktop/Chinmay/react-projects-master/19-stock-photos/final/src/App.js"],"names":["React","useState","useEffect","useRef","FaSearch","Photo","clientID","process","env","REACT_APP_ACCESS_KEY","mainUrl","searchUrl","App","loading","setLoading","photos","setPhotos","page","setPage","query","setQuery","mounted","newImages","setNewImages","fetchImages","urlPage","urlQuery","url","fetch","response","json","data","oldPhotos","results","current","oldPage","event","window","innerHeight","scrollY","document","body","scrollHeight","addEventListener","removeEventListener","handleSubmit","e","preventDefault","target","value","map","image","index"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { FaSearch } from 'react-icons/fa';\n\nimport Photo from './Photo';\nconst clientID = `?client_id=${process.env.REACT_APP_ACCESS_KEY}`;\nconst mainUrl = `https://api.unsplash.com/photos/`;\nconst searchUrl = `https://api.unsplash.com/search/photos/`;\n\n// remove current scroll code\n// set default page to 1\n// setup two useEffects\n// don't run second on initial render\n// check for query value\n// if page 1 fetch images\n// otherwise setPage(1)\n// fix scroll functionality\n\nfunction App() {\n  const [loading, setLoading] = useState(false);\n  const [photos, setPhotos] = useState([]);\n  const [page, setPage] = useState(1);\n  const [query, setQuery] = useState('');\n  const mounted = useRef(false);\n  const [newImages, setNewImages] = useState(false);\n  const fetchImages = async () => {\n    setLoading(true);\n    let url;\n    const urlPage = `&page=${page}`;\n    const urlQuery = `&query=${query}`;\n    if (query) {\n      url = `${searchUrl}${clientID}${urlPage}${urlQuery}`;\n    } else {\n      url = `${mainUrl}${clientID}${urlPage}`;\n    }\n    try {\n      const response = await fetch(url);\n      const data = await response.json();\n      setPhotos((oldPhotos) => {\n        if (query && page === 1) {\n          return data.results;\n        } else if (query) {\n          return [...oldPhotos, ...data.results];\n        } else {\n          return [...oldPhotos, ...data];\n        }\n      });\n      setNewImages(false);\n      setLoading(false);\n    } catch (error) {\n      setNewImages(false);\n\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchImages();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [page]);\n\n  useEffect(() => {\n    if (!mounted.current) {\n      mounted.current = true;\n      return;\n    }\n    if (!newImages) return;\n    if (loading) return;\n    setPage((oldPage) => oldPage + 1);\n  }, [loading, newImages]);\n\n  const event = () => {\n    if (window.innerHeight + window.scrollY >= document.body.scrollHeight - 2) {\n      setNewImages(true);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener('scroll', event);\n    return () => window.removeEventListener('scroll', event);\n  }, []);\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    if (!query) return;\n    if (page === 1) {\n      fetchImages();\n    }\n    setPage(1);\n  };\n  return (\n    <main>\n      <section className='search'>\n        <form className='search-form'>\n          <input\n            type='text'\n            placeholder='search'\n            value={query}\n            onChange={(e) => setQuery(e.target.value)}\n            className='form-input'\n          />\n          <button type='submit' className='submit-btn' onClick={handleSubmit}>\n            <FaSearch />\n          </button>\n        </form>\n      </section>\n      <section className='photos'>\n        <div className='photos-center'>\n          {photos.map((image, index) => {\n            return <Photo key={index} {...image} />;\n          })}\n        </div>\n        {loading && <h2 className='loading'>Loading...</h2>}\n      </section>\n    </main>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}